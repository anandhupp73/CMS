{% load static %}
<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>{% block title %}Admin Dashboard | CPMS{% endblock %}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <!-- Tailwind -->
        <script src="https://cdn.tailwindcss.com"></script>

        <!-- Fonts -->
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />

        <!-- HTMX (for dynamic rendering) -->
        <script src="https://unpkg.com/htmx.org@1.9.10"></script>

        <style>
            body {
                font-family: "Inter", sans-serif;
            }

            .no-scrollbar::-webkit-scrollbar {
                display: none;
            }

            .no-scrollbar {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
        </style>
    </head>

    <body class="bg-slate-50 h-screen overflow-hidden flex flex-col">
        <!-- ================= NAVBAR ================= -->
        <nav
            class="shrink-0 bg-slate-900 text-white h-16 flex items-center px-6 justify-between border-b border-slate-700"
        >
            <div class="flex items-center gap-3">
                <div
                    class="w-8 h-8 bg-orange-500 rounded-lg flex items-center justify-center font-black"
                >
                    CM
                </div>
                <span class="font-bold tracking-tight">CMS</span>
            </div>

            <div class="flex items-center gap-4">
                <span class="text-xs text-slate-300 font-medium">Admin</span>
                <a
                    href="{% url 'logout' %}"
                    class="text-xs font-bold text-red-400 border border-red-400/30 px-3 py-1.5 rounded-lg hover:bg-red-400/10"
                >
                    LOGOUT
                </a>
            </div>
        </nav>

        <!-- ================= LAYOUT ================= -->
        <div class="flex flex-1 overflow-hidden">
            <!-- ========== SIDEBAR ========== -->
            <aside
                class="w-64 bg-white border-r border-slate-200 shrink-0 pt-6"
            >
                <nav class="px-4 space-y-1">
                    <a
                        href="{% url 'admin_dashboard' %}"
                        class="flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium {% if request.resolver_match.url_name == 'admin_dashboard' %} bg-indigo-50 text-indigo-600 {% else %} text-slate-500 hover:bg-slate-50 {% endif %}"
                    >
                        Dashboard
                    </a>

                    <a
                        href="{% url 'admin_view_projects' %}"
                        class="flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium {% if request.resolver_match.url_name == 'admin_view_projects' %} bg-indigo-50 text-indigo-600 {% else %} text-slate-500 hover:bg-slate-50 {% endif %}"
                    >
                        Projects
                    </a>

                    <a
                        href="{% url 'admin_user_list' %}"
                        class="flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium {% if request.resolver_match.url_name == 'admin_user_list' %} bg-indigo-50 text-indigo-600 {% else %} text-slate-500 hover:bg-slate-50 {% endif %}"
                    >
                        Users
                    </a>

                    {% comment %} <a
                        href="#"
                        class="flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-slate-500 hover:bg-slate-50"
                    >
                        Reports
                    </a> {% endcomment %}

                    <a
                        href="{% url 'materials:material_home' %}"
                        class="flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-slate-500 hover:bg-slate-50"
                    >
                        Materials
                    </a>
                </nav>
            </aside>

            <!-- ========== MAIN CONTENT ========== -->
            <main class="flex-1 overflow-y-auto no-scrollbar bg-slate-50">
                <section id="dashboard-content" class="p-8">
                    {% block content %}

                    <!-- HEADER -->
                    <div class="mb-10">
                        <h2
                            class="text-2xl font-bold text-slate-800 tracking-tight"
                        >
                            Admin Dashboard
                        </h2>
                        <p class="text-sm text-slate-500 mt-1 font-medium">
                            Construction Project Management System overview
                        </p>
                    </div>

                    <!-- ================= STATS CARDS ================= -->
                    <div
                        class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-5 gap-6 mb-12"
                    >
                        <!-- Total Projects -->
                        <div
                            class="bg-white border border-slate-200 rounded-2xl p-6 shadow-sm"
                        >
                            <p
                                class="text-[10px] uppercase tracking-widest text-slate-400 font-bold mb-2"
                            >
                                Total Projects
                            </p>
                            <h3 class="text-3xl font-extrabold text-slate-800">
                                {{ total_projects }}
                            </h3>
                            <p class="text-xs text-slate-500 mt-2">
                                {{ active_count }} active
                            </p>
                        </div>

                        <!-- Active Projects -->
                        <div
                            class="bg-white border border-slate-200 rounded-2xl p-6 shadow-sm"
                        >
                            <p
                                class="text-[10px] uppercase tracking-widest text-slate-400 font-bold mb-2"
                            >
                                Active Projects
                            </p>
                            <h3 class="text-3xl font-extrabold text-slate-800">
                                {{ active_count }}
                            </h3>
                            <p class="text-xs text-emerald-600 mt-2 font-bold">
                                Currently running
                            </p>
                        </div>

                        <!-- Delayed (Dummy) -->
                        <div
                            class="bg-white border border-slate-200 rounded-2xl p-6 shadow-sm"
                        >
                            <p
                                class="text-[10px] uppercase tracking-widest text-slate-400 font-bold mb-2"
                            >
                                Delayed
                            </p>
                            <h3 class="text-3xl font-extrabold text-slate-800">
                                {{ delayed_projects }}
                            </h3>
                            <p class="text-xs text-red-600 mt-2 font-bold">
                                Requires attention
                            </p>
                        </div>

                        <!-- Total Budget -->
                        <div
                            class="bg-white border border-slate-200 rounded-2xl p-6 shadow-sm"
                        >
                            <p
                                class="text-[10px] uppercase tracking-widest text-slate-400 font-bold mb-2"
                            >
                                Total Budget
                            </p>
                            <h3 class="text-2xl font-extrabold text-slate-800">
                                ${{ total_budget|floatformat:2 }}
                            </h3>
                            <p class="text-xs text-slate-500 mt-2">
                                Across all projects
                            </p>
                        </div>

                        <!-- Overall Spending (Dummy) -->
                        <div
                            class="bg-white border border-slate-200 rounded-2xl p-6 shadow-sm"
                        >
                            <p
                                class="text-[10px] uppercase tracking-widest text-slate-400 font-bold mb-2"
                            >
                                Overall Spending
                            </p>
                            <h3 class="text-2xl font-extrabold text-slate-800">
                                ${{ overall_spending|floatformat:0 }}
                            </h3>
                            <p class="text-xs text-emerald-600 mt-2 font-bold">
                                {{ spending_percentage }}% of total budget
                            </p>
                        </div>
                    </div>

                    <!-- ================= MAIN GRID ================= -->
                    <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
                        <!-- ALERTS (STATIC / OPTIONAL) -->
                        <div class="space-y-6">
                            <div class="flex items-center justify-between">
                                <h4 class="font-bold text-slate-800 text-sm">
                                    Important Alerts
                                </h4>
                                <span
                                    class="bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-md font-bold"
                                >
                                    3
                                </span>
                            </div>

                            <div class="space-y-4">
                                <div
                                    class="bg-red-50 border border-red-100 p-5 rounded-2xl"
                                >
                                    <p class="text-xs font-bold text-red-800">
                                        Project Delay Detected
                                    </p>
                                    <p
                                        class="text-[11px] text-red-600 mt-2 font-medium"
                                    >
                                        One or more projects are behind
                                        schedule.
                                    </p>
                                </div>

                                <div
                                    class="bg-amber-50 border border-amber-100 p-5 rounded-2xl"
                                >
                                    <p class="text-xs font-bold text-amber-800">
                                        Pending Approvals
                                    </p>
                                    <p
                                        class="text-[11px] text-amber-600 mt-2 font-medium"
                                    >
                                        Financial approvals pending review.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- ================= ACTIVE PROJECTS ================= -->
                        <div class="xl:col-span-2 space-y-6">
                            <h4 class="font-bold text-slate-800 text-sm">
                                Active Projects
                            </h4>

                            {% for project in active_projects %}
                            <div
                                class="bg-white border border-slate-200 rounded-3xl p-7 shadow-sm"
                            >
                                <div
                                    class="flex justify-between items-start mb-6"
                                >
                                    <div>
                                        <h5
                                            class="font-bold text-slate-800 text-base"
                                        >
                                            {{ project.name }}
                                        </h5>
                                        <p class="text-xs text-slate-400 mt-1">
                                            {{ project.manager.get_full_name }}
                                            • {{ project.start_date }} – {{ project.end_date }}
                                        </p>

                                    </div>

                                    <span
                                        class="bg-emerald-50 text-emerald-700 text-[9px] font-bold px-3 py-1 rounded-full uppercase border border-emerald-100"
                                    >
                                        Active
                                    </span>
                                </div>

                                <!-- Progress -->
                                <div class="space-y-4">
                                    <div>
                                        <div
                                            class="flex justify-between text-[10px] font-bold text-slate-400 mb-2 uppercase"
                                        >
                                            <span>Progress</span>
                                            <span
                                                >{{ project.total_progress}}%</span>
                                        </div>
                                        <div
                                            class="h-2.5 bg-slate-100 rounded-full overflow-hidden"
                                        >
                                            <div
                                                class="h-full bg-slate-800"
                                                style="width: {{ project.total_progress }}%"
                                            ></div>
                                        </div>
                                    </div>

                                    <!-- Budget -->
                                    <div>
                                        <div
                                            class="flex justify-between text-[10px] font-bold text-slate-400 uppercase"
                                        >
                                            <span>Budget</span>
                                            <span>${{ project.budget }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% empty %}
                            <p class="text-sm text-slate-400">
                                No active projects available.
                            </p>
                            {% endfor %}
                        </div>
                    </div>

                    {% endblock %}
                </section>
            </main>
        </div>
    </body>
</html>
